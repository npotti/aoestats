define(["require","exports","../utils/commonutils","ojs/ojarraydataprovider","knockout","ojs/ojtable","ojs/ojchart","ojs/ojmenu","ojs/ojoption","ojs/ojarraytabledatasource"],(function(require,e,t,s,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.capQuotaObservableArray=a.observableArray([]),this.capQuotaObservable=a.observable(),this.playersPlayedObservableArray=a.observableArray([]),this.playersPlayedObservable=a.observable(),this.vegTallyTableList=a.observableArray([]),this.chartObservableArray=a.observableArray([]),this.chartObservable=a.observable(),this.tallyUrl="https://fopfpl.in/tes/api/veg_tally",this.curr_gw=1,this.eoTableList=a.observableArray([]),this.eoDataProvider=a.observable(),this.aoePlayerMap=new Map,this.chipTableList=a.observableArray([]),this.chipDataProvider=a.observable(),this.selectedMenuItem=a.observable(""),this.aoeEoVisible=a.observable(!1),this.capVCVisible=a.observable(!0),this.livePlayerVisible=a.observable(!1),this.chipStatusVisible=a.observable(!1),this.livePlayerChartVisible=a.observable(!1),this.datasource=a.observableArray(),this.userTeam=a.observable(),this.menuItemAction=e=>{this.selectedMenuItem(e.target.value),"capVC"===this.selectedMenuItem()?(this.capVCVisible(!0),this.aoeEoVisible(!1),this.chipStatusVisible(!1),this.livePlayerChartVisible(!1),this.livePlayerVisible(!1)):"aoeEO"===this.selectedMenuItem()?(this.capVCVisible(!1),this.aoeEoVisible(!0),this.chipStatusVisible(!1),this.livePlayerChartVisible(!1),this.livePlayerVisible(!1)):"livePlyrsRem"===this.selectedMenuItem()?(this.capVCVisible(!1),this.aoeEoVisible(!1),this.chipStatusVisible(!1),this.livePlayerChartVisible(!1),this.livePlayerVisible(!0)):"livePlyrsChart"===this.selectedMenuItem()?(this.capVCVisible(!1),this.aoeEoVisible(!1),this.chipStatusVisible(!1),this.livePlayerChartVisible(!0),this.livePlayerVisible(!1)):"chipStatus"===this.selectedMenuItem()&&(this.capVCVisible(!1),this.aoeEoVisible(!1),this.chipStatusVisible(!0),this.livePlayerChartVisible(!1),this.livePlayerVisible(!1))};t.default.fetchCurrGW().then(e=>{this.curr_gw=e,this.fetchAoeEO(this.curr_gw),this.vegTallyDataProvider=a.observable(new s(this.vegTallyTableList));let i=1;for(;i<=10;i++)this.fetchTeamVegTally(this.curr_gw,i);console.log("user team"+t.default.team()),this.userTeam(t.default.team())});this.fetchFplChipCounts().then(e=>{this.chipDataProvider(new s(this.chipTableList))}),this.fetchCapQuota()}fetcheo(e,t){return new Promise(s=>{fetch(e).then(e=>e.json()).then(e=>{e.forEach(e=>{if(t.get(e.name)){let s=t.get(e.name);s+=e.count,t.set(e.name,s)}else t.set(e.name,e.count)}),s(e)})})}fetchCapQuota(){fetch("https://fopfpl.in/tes/api/game_week/scores/").then(e=>e.json()).then(e=>{const a=e;let i=new Map,r=new Map,l=new Map;a.forEach(e=>{let t=0;for(;t<10;t++){let s=i.get(t),a=r.get(t),h=l.get(t);if(s||(s=new Map),a||(a=new Map),h||(h=new Map),s.has(e[t].captain.first_name)){let a=s.get(e[t].captain.first_name);a+=1,s.set(e[t].captain.first_name,a)}else s.set(e[t].captain.first_name,1);if(a.has(e[t].substitute.first_name)){let s=a.get(e[t].substitute.first_name);s+=1,a.set(e[t].substitute.first_name,s)}else a.set(e[t].substitute.first_name,1);if(h.has(e[t].vice_captain.first_name)){let s=h.get(e[t].vice_captain.first_name);s+=1,h.set(e[t].vice_captain.first_name,s)}else h.set(e[t].vice_captain.first_name,1);i.set(t,s),r.set(t,a),l.set(t,h)}});let h=0;for(;h<10;h++){let e="";for(let t of Array.from(i.get(h).entries())){e=e+t[0]+":"+t[1]+","}let s="";for(let e of Array.from(r.get(h).entries())){s=s+e[0]+":"+e[1]+","}let a="";for(let e of Array.from(l.get(h).entries())){a=a+e[0]+":"+e[1]+","}e.endsWith(",")&&(e=e.substring(0,e.length-1)),s.endsWith(",")&&(s=s.substring(0,s.length-1)),a.endsWith(",")&&(a=a.substring(0,a.length-1));var o={teamName:t.default.fetchTeamName(h+1),capQuota:e,subQuota:s,vcCount:a};this.capQuotaObservableArray.push(o)}this.capQuotaObservable(new s(this.capQuotaObservableArray))})}fetchTeamVegTally(e,a){let i=this.tallyUrl+"/"+e+"/"+a;fetch(i).then(e=>e.json()).then(e=>{const i=e;let r=0,l=0,h=0,o=new Map;i.forEach(e=>{0!==e.score?r+=e.count:(l+=e.count,o.set(e.name,e.count)),h+=e.count,this.vegTallyTableList().push(e)});let n="";for(let e of Array.from(o.entries())){n=n+e[0]+":"+e[1]+","}n.endsWith(",")&&(n=n.substring(0,n.length-1));let b=t.default.fetchTeamName(a);var c={team:a,teamName:b,playersPlayed:r,playersRemaining:l,totalPlayers:h,remainingPlayerData:n},p={id:a,group:"Players Played",value:r,series:b},u={id:a,group:"Players Remaining",value:l,series:b};this.chartObservableArray.push(p),this.chartObservableArray.push(u),this.playersPlayedObservableArray.push(c),this.playersPlayedObservableArray.sort((e,t)=>e.playersRemaining>t.playersRemaining?-1:e.playersRemaining<t.playersRemaining?1:0),this.vegTallyDataProvider(new s(this.vegTallyTableList)),this.playersPlayedObservable(new s(this.playersPlayedObservableArray)),this.chartObservable(new s(this.chartObservableArray))})}fetchAoeEO(e){let a=new Map;const i=[];for(let t=1;t<=10;t++){let s=this.tallyUrl+"/"+e+"/"+t;i.push(this.fetcheo(s,a))}Promise.all(i).then(e=>{for(let e of Array.from(a.entries())){let s=e[0],a=e[1],i=a/60*100,r={player:s,count:a,percent:t.default.roundToTwo(i)};this.eoTableList.push(r)}this.eoTableList.sort((e,t)=>e.percent>t.percent?-1:e.percent<t.percent?1:0),this.eoDataProvider(new s(this.eoTableList))})}fetchFplChipCounts(){return new Promise(e=>{let s=t.default.fetchAoeTeams();const a=[];s.then(s=>{s.forEach(s=>{let i=0,r=0,l=0,h=0;s.players.forEach(e=>{this.aoePlayerMap.set(e.first_name+" "+e.last_name+" ("+t.default.fetchTeamName(s.id)+" )",e.fpl_id);let o=t.default.fetchFplMgrHistory(e.fpl_id);a.push(o),o.then(e=>{let t=e.chips;t.length>0&&t.forEach(e=>{"wildcard"===e.name?i+=1:"3xc"===e.name?h+=1:"freehit"===e.name?r+=1:"bboost"===e.name&&(l+=1)})})}),Promise.all(a).then(a=>{let o="WCs Used :: "+i+", TCs Used :: "+h+", FHs Used :: "+r+" BBs Used :: "+l,n={team:t.default.fetchTeamName(s.id),info:o,wcUsed:i,tcUsed:h,fhUsed:r,bbUsed:l};this.chipTableList.push(n),e(!0)})})})})}connected(){}disconnected(){}transitionCompleted(){}}}));